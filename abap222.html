
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
</head>
<style type="text/css">
    /* внешние границы таблицы серого цвета толщиной 1px */
table {border: 0.5px solid } 
/* границы ячеек первого ряда таблицы */
th {border: 0.5px solid;
text-align: center;}
/* границы ячеек тела таблицы */
td {border: 0.5px solid;
  text-align: center;
 }
  #table1{
  
  }
</style>
<body>
	<a>
    <span>
      Ведите номер документа: 
<input type="text" id="display" name="result" onchange="input()">
    </span>

<br>
<span>&nbsp;</span>
</a>
  <table id="table1" style="border:1px solid;"
  cellspacing="0">



  
</table>
<script type="text/javascript">



  

var head = {

    "ndoc": [8100000000 ,8100000001 ],

  "year": [2018,2019],

  "data": ['01.12.2018','01.01.2019']

  

};



var pos = {

    "ndoc": [8100000000 ,8100000000,8100000001,8100000001,8100000001 ],

  "npoz": [1,2,1,2,3],

  "textpoz": ['Текст позиции 1 док 1','Текст позиции 2 док 1','Текст позиции 1 док 1','Текст позиции 2 док 2','Текст позиции 3 док 2'],

"sum": [100,-100,200,150,-100]
  

};
var ht = ['Номер','Год','Позиция','Текст позиции','Сумма'];




var ndochead=head.ndoc;
var yearhead = head.year;
var ndocpos = pos.ndoc;
var npozpos = pos.npoz;
var textpozpos = pos.textpoz;
var sumpos = pos.sum;
var headl = ndochead.length;
var posl = ndocpos.length;
var q778 = [];
var q777 = [];
var q888 = [];
var q999 = [];
var q100 = [];
var input = document.getElementById('display');
input.oninput = function() {
	ndochead=head.ndoc;
 yearhead = head.year;
 ndocpos = pos.ndoc;
 npozpos = pos.npoz;
 textpozpos = pos.textpoz;
 sumpos = pos.sum;

  
    var k = 0;
    var d =input.value;
    var i = 0;
    for (i = 0; i < ndochead.length; i++) {
      if (d == ndochead[i]) {
   tr(d);
 }
 else {
 	
 	k++;
 	
 }
 }
 if (k==ndochead.length) {
 


ndochead=head.ndoc;
 yearhead = head.year;
 ndocpos = pos.ndoc;
 npozpos = pos.npoz;
 textpozpos = pos.textpoz;
sumpos = pos.sum;
 headl = ndochead.length;
 posl = ndocpos.length;
 q778 = [];
 q777 = [];
 q888 = [];
 q999 = [];
 q100 = [];
table(ndochead,npozpos,ndocpos,textpozpos,sumpos);






 }
  };

  function tr(d) {
  	q778.push(d);
    var i = 0;
    var ndocpos = pos.ndoc;
    
    var npozpos = pos.npoz;
    var textpozpos = pos.textpoz;
    var sumpos = pos.sum;

    var qqq = ndocpos.length;
    
    while (qqq != 0) {
     
      if (d == ndocpos[i]) {
        
        q777.push(ndocpos[i]);
        q888.push(npozpos[i]);
        q999.push(textpozpos[i]);
        q100.push(sumpos[i]);

        /*q888.push(npozpos[i]);*/
        /*table(q777);*/
        
      }
      qqq=qqq-1;
      i++;

    }
    
   headl = 1;
   posl =q777.length;
   ndocpos=q777;
   npozpos=q888;
   textpozpos=q999;
   sumpos=q100;
    table(q778,q888,q777,q999,q100);
  };


table(ndochead,npozpos,ndocpos,textpozpos,sumpos);
function table(ndochead,npozpos,ndocpos,textpozpos,sumpos) {
var str = document.getElementById('table1');
str.innerHTML = "";
var mi = 0;
var addTr = document.createElement("tr");
for ( mi = 0; mi < ht.length; mi++) {

var addTd = document.createElement("th");
        addTd.innerHTML=ht[mi];
        
    addTr.appendChild(addTd);
    str.appendChild(addTr);
    
}


  /*var headl = ndochead.length;*/
/*var posl = ndocpos.length;*/
var hi = 0;
var sumobh = 0;
while (headl != 0) {
  var addTr = document.createElement("tr");
  var addTd = document.createElement("td");
  addTd.innerHTML=ndochead[hi];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);

  

  var addTd = document.createElement("td");
  addTd.innerHTML=yearhead[hi];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);
  

  var nh = ndochead[hi];
  
  var i = 0;
  var q1 = [];
  var q2 = [];
  var q3 = [];
  var q4 = [];
  var sum = 0;
  
  for (i = 0; i < posl; i++) {
  	
  	
    if (ndocpos[i] == nh) {

      if (sum == 0) {
      	
         var addTd = document.createElement("td");
  addTd.innerHTML=npozpos[i];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);

      console.log(npozpos[i]);

      var addTd = document.createElement("td");
  addTd.innerHTML=textpozpos[i];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);

      console.log(textpozpos[i]);

      var addTd = document.createElement("td");
  addTd.innerHTML=sumpos[i];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);


      console.log(sumpos[i]);
      sum = sum + sumpos[i];

      }
     else{

      var addTr = document.createElement("tr");
  var addTd = document.createElement("td");
  addTd.innerHTML=null;
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);



  var addTd = document.createElement("td");
  addTd.innerHTML=null;
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);
  

       var addTd = document.createElement("td");
  addTd.innerHTML=npozpos[i];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);

      console.log(npozpos[i]);

      var addTd = document.createElement("td");
  addTd.innerHTML=textpozpos[i];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);

      console.log(textpozpos[i]);

      var addTd = document.createElement("td");
  addTd.innerHTML=sumpos[i];
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);


      console.log(sumpos[i]);
      sum = sum + sumpos[i];
     }

      

    }
    else{
    	
      q1.push(npozpos[i]);
      q2.push(textpozpos[i]);
      q3.push(sumpos[i]);
      q4.push(ndocpos[i]);
     
    }


  }
  console.log(q1);

    var addTr = document.createElement("tr");
  var addTd = document.createElement("td");
  addTd.innerHTML='Всего по документу '+(hi+1)+'&nbsp;';
       addTd.setAttribute('colSpan', '4');
       addTd.style = 'text-align:right';
    addTr.appendChild(addTd);
    str.appendChild(addTr);
    var addTd = document.createElement("td");
  addTd.innerHTML=sum;
     
       
    addTr.appendChild(addTd);
    str.appendChild(addTr);
  
  posl = q1.length;
  ndocpos = q4;
  npozpos=q1;
  textpozpos=q2;
  sumpos=q3;
  hi++;
  headl=headl-1;
  sumobh=sumobh+sum;


}
var addTr = document.createElement("tr");
  var addTd = document.createElement("td");

  addTd.innerHTML='Итого'+'&nbsp;';
       addTd.setAttribute('colSpan', '4');
       addTd.style = 'text-align:right';

    addTr.appendChild(addTd);
    str.appendChild(addTr);
     var addTd = document.createElement("td");

  addTd.innerHTML=sumobh;
       

    addTr.appendChild(addTd);
    str.appendChild(addTr);
 console.log("общая сумма по всем позицияс",sumobh);

}

 


</script>


</body>
</html>

